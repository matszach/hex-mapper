1. change map to [][]
2. expand globalstate to more than state/update